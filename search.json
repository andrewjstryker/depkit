[{"path":[]},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"overview","dir":"","previous_headings":"","what":"Overview","title":"DESIGN.md — depkit","text":"depkit build-time HTML asset dependency manager R. manages CSS JavaScript assets produced R tooling (notably htmlwidgets) provides deterministic, usage-agnostic way : deduplicate assets, preserve first-seen ordering, copy local assets target directory, optionally apply verified CDN logic JavaScript, emit HTML snippets (<link>, <script>) callers insert documents constructing. depkit write HTML files, track emitted, impose document layout policy.","code":""},{"path":[]},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"depkit-does","dir":"","previous_headings":"Sharpened focus","what":"depkit does","title":"DESIGN.md — depkit","text":"Track CSS JS assets ordered unique sets Deduplicate dependencies name@version Copy local assets configured output directory Optionally verify emit CDN-backed JavaScript fallback newly added assets, known assets (ordered, deduped)","code":""},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"depkit-does-not","dir":"","previous_headings":"Sharpened focus","what":"depkit does not","title":"DESIGN.md — depkit","text":"Write complete HTML documents Track whether assets emitted Decide snippets belong document Maintain “prepared” “emitted” state Integrate site generators (Hugo, etc.)","code":""},{"path":[]},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"dependency-key","dir":"","previous_headings":"Core concepts","what":"Dependency key","title":"DESIGN.md — depkit","text":"dependency uniquely identified : key used registry deduplication.","code":"dep_key = paste0(dep$name, \"@\", dep$version)"},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"asset-id","dir":"","previous_headings":"Core concepts","what":"Asset id","title":"DESIGN.md — depkit","text":"asset uniquely identified : rel_path stylesheet script path declared dependency. Asset ids : - stable - output-agnostic - sole unit tracked dependency manager URL resolution filesystem paths derived later.","code":"asset_id = paste0(dep_key, \"::\", rel_path)"},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"architecture","dir":"","previous_headings":"","what":"Architecture","title":"DESIGN.md — depkit","text":"depkit two public classes one internal representation.","code":""},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"class-diagram","dir":"","previous_headings":"","what":"Class diagram","title":"DESIGN.md — depkit","text":"","code":"classDiagram   class DependencyManager {     <<S4>>     +registry: named list<html_dependency>     +css_assets: character     +js_assets: character     +config: list      +insert(x) InsertUpdate     +emit_css(keys=NULL) character     +emit_js(keys=NULL) character     +has(key) logical     +remove(key) DependencyManager     +names() character     +length() integer   }      class InsertUpdate {     <<S4>>     +dm: DependencyManager     +added_css: character     +added_js: character      +dm() DependencyManager     +is_empty() logical     +emit_css() character     +emit_js() character     +insert(x) InsertUpdate   }    InsertUpdate --> DependencyManager : dm   DependencyManager --> InsertUpdate : insert()"},{"path":[]},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"responsibilities","dir":"","previous_headings":"DependencyManager","what":"Responsibilities","title":"DESIGN.md — depkit","text":"DependencyManager (DM) holds persistent state depkit: dependency registry (deduped dep_key) ordered unique CSS asset ids ordered unique JS asset ids configuration (Option )","code":""},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"configuration-option-a","dir":"","previous_headings":"DependencyManager","what":"Configuration (Option A)","title":"DESIGN.md — depkit","text":"Configuration stored DM applies uniformly: output_root — filesystem directory copied assets url_root — URL prefix used emitted tags cdn_mode — \"\" \"verify\" (JavaScript ) Configuration affects copying emission, stateful sense “prepared” “emitted”.","code":""},{"path":[]},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"purpose","dir":"","previous_headings":"InsertUpdate (delta + façade)","what":"Purpose","title":"DESIGN.md — depkit","text":"InsertUpdate higher-level API object : captures “changed” insertion delegates emission back DM reduces caller reasoning burden plumbing introduces new capability.","code":""},{"path":[]},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"insertdm-x","dir":"","previous_headings":"Insert semantics","what":"insert(dm, x)","title":"DESIGN.md — depkit","text":"Insertion functional: Normalize input (html_dependency, htmlwidget, list) Resolve dependencies assets asset ids Compare asset ids DM’s ordered sets","code":""},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"case-1-already-present","dir":"","previous_headings":"Insert semantics > insert(dm, x)","what":"Case 1: Already present","title":"DESIGN.md — depkit","text":"new asset ids discovered files copied Return InsertUpdate empty added_css / added_js DM returned unchanged","code":""},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"case-2-new-assets-discovered","dir":"","previous_headings":"Insert semantics > insert(dm, x)","what":"Case 2: New assets discovered","title":"DESIGN.md — depkit","text":"Extend DM’s ordered sets new asset ids Copy local asset files new assets overwriting allowed skipping identical files preferred optional Return InsertUpdate containing newly added asset ids","code":""},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"key-invariant","dir":"","previous_headings":"Insert semantics","what":"Key invariant","title":"DESIGN.md — depkit","text":"DM never tracks whether assets emitted prepared. tracks assets exist, order.","code":""},{"path":[]},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"emission-via-insertupdate-new-only","dir":"","previous_headings":"Emission model","what":"Emission via InsertUpdate (new-only)","title":"DESIGN.md — depkit","text":"Emits snippets newly added assets Implemented calling DM emission keys = added_asset_ids mutate DM InsertUpdate","code":"u <- insert(dm, widget) html <- emit_css(u)"},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"emission-via-dependencymanager-all-assets","dir":"","previous_headings":"Emission model","what":"Emission via DependencyManager (all assets)","title":"DESIGN.md — depkit","text":"Emits assets given type Preserves first-seen order deduplication logic required emit time","code":"html_css <- emit_css(dm) html_js  <- emit_js(dm)"},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"internal-asset-records-implementation-detail","dir":"","previous_headings":"","what":"Internal asset records (implementation detail)","title":"DESIGN.md — depkit","text":"depkit constructs ephemeral asset records internally : insertion (copying) emission (tag generation) records stored part public API.","code":""},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"conceptual-structure","dir":"","previous_headings":"Internal asset records (implementation detail)","what":"Conceptual structure","title":"DESIGN.md — depkit","text":"internal asset record contains: Common: asset_id kind (css / js) dep_key rel_path src_dir out_path url JavaScript (cdn_mode = \"verify\"): cdn_url (optional) integrity (sha384) fallback_url verified flag Records derived deterministically : DM state configuration filesystem inspection","code":""},{"path":[]},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"css","dir":"","previous_headings":"Emission behavior","what":"CSS","title":"DESIGN.md — depkit","text":"Always local-Emitted :","code":"<link rel=\"stylesheet\" href=\"URL\">"},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"javascript","dir":"","previous_headings":"Emission behavior","what":"JavaScript","title":"DESIGN.md — depkit","text":"cdn_mode = \"\" Emit local <script src=\"URL\"><\/script> cdn_mode = \"verify\" Verify CDN content matches local bytes verified: verification fails: emit local-","code":"<script src=\"CDN_URL\"         integrity=\"sha384-...\"         crossorigin=\"anonymous\"         onerror=\"this.onerror=null;this.src='LOCAL_URL';\"> <\/script>"},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"typical-workflow-caller-defined-policy","dir":"","previous_headings":"","what":"Typical workflow (caller-defined policy)","title":"DESIGN.md — depkit","text":"Example: “emit CSS encountered, JS end” depkit enables policy enforce .","code":"flowchart TD   A[\"Start: dm\"] --> B[\"insert(dm, widget1) -> u1\"]   B --> C[\"emit_css(u1)\"]   C --> D[\"dm1 = dm(u1)\"]   D --> E[\"insert(dm1, widget2) -> u2\"]   E --> F[\"emit_css(u2)\"]   F --> G[\"dm2 = dm(u2)\"]   G --> H[\"End of document\"]   H --> I[\"emit_js(dm2)\"]"},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"error-handling-philosophy","dir":"","previous_headings":"","what":"Error handling philosophy","title":"DESIGN.md — depkit","text":"Malformed dependencies → hard error Asset copy failure → hard error CDN verification failure → warning + local fallback Network failures never fatal depkit always fails closed local assets.","code":""},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"coding-style-guidance","dir":"","previous_headings":"","what":"Coding style guidance","title":"DESIGN.md — depkit","text":"Avoid probing--correctness Use explicit class checks; fail fast Keep porcelain thin S4 orchestrates; logic lives utilities Determinism cleverness Preserve insertion order; implicit sorting hidden state “prepared”, “emitted”, “already handled” flags","code":""},{"path":"https://andrewjstryker.github.io/depkit/DESIGN.html","id":"summary","dir":"","previous_headings":"","what":"Summary","title":"DESIGN.md — depkit","text":"depkit provides clean, deterministic boundary: DependencyManager — canonical asset state InsertUpdate — explicit delta + ergonomic emission Insert — may copy new assets Emit — returns HTML snippets, nothing Callers decide snippets go. depkit decides snippets .","code":""},{"path":[]},{"path":"https://andrewjstryker.github.io/depkit/TODO.html","id":"rename-from-assetman-to-depkit","dir":"","previous_headings":"","what":"Rename from assetman to depkit","title":"TODO — depkit","text":"DESCRIPTION: update Package, Title _pkgdown.yml: update site URL references README.md: update package name examples DESIGN.md: replace assetman references depkit tests/testthat.R: library(depkit) test_check(\"depkit\") tests/testthat/helper-assetman.R: renamed helper-depkit.R test files: assetman::: → depkit::: R/class-definition.R roxygen: updated package name reference NAMESPACE: regenerate roxygen updates GitHub repo name (applicable)","code":""},{"path":"https://andrewjstryker.github.io/depkit/TODO.html","id":"implementation-fixes-applied","dir":"","previous_headings":"","what":"Implementation fixes applied","title":"TODO — depkit","text":"Asset output paths scoped name-version/ subdirectory prevent filename collisions dependencies (added dep_subdir())","code":""},{"path":"https://andrewjstryker.github.io/depkit/TODO.html","id":"remaining-implementation","dir":"","previous_headings":"","what":"Remaining implementation","title":"TODO — depkit","text":"CDN verification workflow: cdn_mode = \"verify\" trusts dep$meta$cdn metadata fetch CDN content verify byte-equivalence — needs curl httr2 download + comparison local file Document dep$meta$cdn convention: structure list(\"rel_path\" = list(url=, integrity=, fallback_url=)) bare URL string","code":""},{"path":"https://andrewjstryker.github.io/depkit/TODO.html","id":"tests-added","dir":"","previous_headings":"","what":"Tests added","title":"TODO — depkit","text":"CDN verify mode: cdn_entry_for(), build_asset_records() CDN branch, js_tag() CDN output, end--end emit compute_sri_hash sha384 (default openssl path) dep_subdir format Asset collision prevention (two deps, filename) insert(InsertUpdate, ) chaining normalize_insert_input error unsupported types emit_css/emit_js InsertUpdate: default keys (added ), empty delta, explicit key override is_empty reflects delta state remove(DependencyManager, ) fallback dispatch names<- length mismatch error Config validation: invalid cdn_mode, vector-length output_root/url_root","code":""},{"path":"https://andrewjstryker.github.io/depkit/TODO.html","id":"remaining-test-gaps","dir":"","previous_headings":"","what":"Remaining test gaps","title":"TODO — depkit","text":"dependency_source_dir package field: system.file() branch needs test using real installed package flatten_asset_spec list--descriptor inputs (script descriptors src key, stylesheet descriptors href key)","code":""},{"path":"https://andrewjstryker.github.io/depkit/TODO.html","id":"documentation","dir":"","previous_headings":"","what":"Documentation","title":"TODO — depkit","text":"Add roxygen documentation exported generics classes Document dep$meta$cdn convention CDN metadata dependencies Add vignette showing realistic multi-widget workflow Populate pkgdown reference index _pkgdown.yml","code":""},{"path":"https://andrewjstryker.github.io/depkit/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Andrew Stryker. Author, maintainer.","code":""},{"path":"https://andrewjstryker.github.io/depkit/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Stryker (2026). depkit: Build-Time HTML Dependency Kit. R package version 0.0.0.9000, https://andrewjstryker.github.io/depkit.","code":"@Manual{,   title = {depkit: Build-Time HTML Dependency Kit},   author = {Andrew Stryker},   year = {2026},   note = {R package version 0.0.0.9000},   url = {https://andrewjstryker.github.io/depkit}, }"},{"path":"https://andrewjstryker.github.io/depkit/index.html","id":"depkit","dir":"","previous_headings":"","what":"depkit","title":"depkit","text":"depkit build-time HTML dependency kit R. tracks css/js assets ordered unique sets, copies newly discovered files, emits deterministic <link> / <script> snippets derived dependency metadata.","code":""},{"path":"https://andrewjstryker.github.io/depkit/index.html","id":"quick-start","dir":"","previous_headings":"","what":"Quick start","title":"depkit","text":"Insert always returns InsertUpdate delta; emission pure stateless.","code":"library(depkit)  dm <- DependencyManager(   output_root = tempfile(\"asset-output\"),   url_root = \"/assets\" )  dep <- htmltools::htmlDependency(   name = \"demo\",   version = \"1.0.0\",   src = c(file = system.file(\"www\", package = \"htmlwidgets\")),   script = \"htmlwidgets.js\",   stylesheet = \"htmlwidgets.css\" )  u <- insert(dm, dep)  # emit only newly added assets emit_css(u) emit_js(u)  # emit all known assets emit_css(dm(u)) emit_js(dm(u))"}]
